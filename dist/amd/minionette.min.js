// Backbone.Minionette
// -------------------
// v0.2.0
//
// Copyright (c)2013 Justin Ridgewell
// Distributed under MIT license
//
// https://github.com/jridgewell/minionette

(function(e,t){if("object"==typeof exports){var i=require("underscore"),n=require("jquery"),s=require("backbone");module.exports=t(i,n,s)}else"function"==typeof define&&define.amd&&define(["underscore","jquery","backbone"],t)})(this,function(e,t,i){return function(e,t,i,n){"use strict";var s={};return n.Minionette=s,i.event.special.remove={remove:function(e){e.handler&&e.handler()}},s.View=n.View.extend({constructor:function(){n.View.apply(this,arguments),t.bindAll(this,"_jquery_remove","_close"),this._subViews={},this._listenToEvents(this.model,this.modelEvents),this._listenToEvents(this.collection,this.collectionEvents),this.listenTo(this,"close:before",this._close)},template:function(){return""},delegateEvents:function(e){n.View.prototype.delegateEvents.apply(this,e),this.$el.on("remove.delegateEvents"+this.cid,this._jquery_remove)},close:function(){this.trigger("close:before"),this.remove(),this.trigger("close")},_close:function(){t.each(this._subViews,function(e){e.close()})},assign:function(e,i,n){var s;t.isObject(e)?(s=e,n=i):(s={},s[e]=i),s&&t.each(s,function(e,t){this._subViews[e.cid]=e,n?this.$(t).replaceWith(e.el):e.setElement(this.$(t)).render()},this)},_jquery_remove:function(){this.close()},_listenToEvents:function(e,i){for(var n in i){var s=i[n];t.isFunction(s)||(s=this[s]),s&&this.listenTo(e,n,s)}return this}}),s.ModelView=s.View.extend({serializeData:function(){return this.model.attributes},render:function(){return this.trigger("render:before"),t.each(this._subViews,function(e){e.$el.detach()}),this.$el.html(this.template(this.serializeData())),this.trigger("render"),this}}),s.CollectionView=s.View.extend({ModelView:n.View,collectionEvents:{add:"addOne",remove:"removeOne",reset:"render"},render:function(){this.trigger("render:before"),this.$el.html(this.template(this.collection));var e=this._getModelView();return this.collection.each(function(t){this._addModelView(t,e)},this),this.trigger("render"),this},addOne:function(e){this.trigger("addOne:before");var t=this._getModelView();this._addModelView(e,t),this.trigger("addOne")},removeOne:function(e){this.trigger("removeOne:before");var t=this._findSubViewByModel(e);this._removeModelView(t),this.trigger("removeOne")},_addModelView:function(e,t){var i=new t({model:e});this._subViews[i.cid]=i,this.$el.append(i.render().el)},_getModelView:function(){var e=this.ModelView;return this.options&&this.options.ModelView&&(e=this.option.ModelView),e},_removeModelView:function(e){e&&(e.close(),delete this._subViews[e.cid])},_findSubViewByModel:function(e){return t.findWhere(this._subViews,{model:e})}}),s}(this,e,t,i),i.Minionette});